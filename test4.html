<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–î–µ—Ç—Å–∫–∞—è –í–∏–∫—Ç–æ—Ä–∏–Ω–∞ (–í–æ–ø—Ä–æ—Å-–û—Ç–≤–µ—Ç)</title>
    <style>
        :root {
            /* –¶–í–ï–¢–ê */
            --color-correct: #00A000; /* –ó–µ–ª–µ–Ω—ã–π –¥–ª—è –ø–æ–±–µ–¥—ã/—É—Å–ø–µ—Ö–∞ */
            --color-absent: #787C7E; 
            --color-unused: #D3D6DA; 
            --color-text: #000000; /* –ß–µ—Ä–Ω—ã–π –¥–ª—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ */
            --color-blue: #1565C0; /* –°–∏–Ω–∏–π –¥–ª—è –≤–æ–ø—Ä–æ—Å–∞/—Ç–∞–π–º–µ—Ä–∞ */
            --color-button-bg: #4CAF50; /* –ó–µ–ª–µ–Ω—ã–π –¥–ª—è –∫–Ω–æ–ø–∫–∏ */
            --color-button-text: white;
        }

        body {
            font-family: Tahoma, Arial, sans-serif;
            margin: 0;
            background-image: url('https://img.freepik.com/premium-vector/cute-kid-scribble-line-flower-heart-rainbow-background-hand-drawn-doodle-sketch-childish-element_787654-934.jpg?semt=ais_hybrid&w=740');
            background-repeat: repeat;
            background-size: 300px; 
            background-color: rgba(255, 255, 255, 0.6); 
            background-blend-mode: overlay; 
            color: var(--color-text);
            display: flex;
            flex-direction: column;
            justify-content: center; 
            align-items: center; 
            min-height: 100vh; 
            padding: 20px; 
            box-sizing: border-box;
        }
        
        /* –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä, –∫–æ—Ç–æ—Ä—ã–π —Ç–µ–ø–µ—Ä—å –≤—Å–µ–≥–¥–∞ Flex-—Å—Ç–æ–ª–±–µ—Ü –¥–ª—è –ø–æ—Ä—è–¥–∫–∞ —Å–≤–µ—Ä—Ö—É –≤–Ω–∏–∑ */
        .game-section {
            background-color: rgba(255, 255, 255, 0.95); 
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2); 
            width: 90%;
            max-width: 600px;
            text-align: center;
            /* –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ–º –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–µ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –°–í–ï–†–•–£ –í–ù–ò–ó */
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        /* –°–∫—Ä—ã–≤–∞–µ–º –∏–≥—Ä–æ–≤–æ–π —Ä–∞–∑–¥–µ–ª –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
        #quiz-container {
            display: none; 
        }

        h1 { font-size: 1.8em; margin-bottom: 20px; color: var(--color-blue); }
        p { margin-top: 5px; margin-bottom: 15px; }

        /* --- –°—Ç–∏–ª–∏ –¥–ª—è –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ --- */
        .auth-input-group {
            margin-bottom: 20px;
            width: 100%;
            max-width: 350px; 
            text-align: left;
        }
        /* –°–∫—Ä—ã–≤–∞–µ–º –º–µ—Ç–∫—É (label) –ø–æ–ª–Ω–æ—Å—Ç—å—é */
        .auth-input-group label {
            display: none;
        }
        .auth-input-group input {
            width: calc(100% - 22px); 
            padding: 10px;
            border: 2px solid var(--color-blue);
            border-radius: 6px;
            font-size: 1em;
            text-transform: capitalize;
            box-sizing: border-box;
        }
        
        #continue-button {
            background-color: var(--color-button-bg);
            color: var(--color-button-text);
            border: none;
            padding: 12px 30px;
            font-size: 1.2em;
            font-weight: bold;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s;
            width: 100%;
            max-width: 250px;
        }
        #continue-button:hover {
            background-color: #43A047;
        }
        /* --------------------------- */
        
        /* --- –°—Ç–∏–ª–∏ –¥–ª—è –í–∏–∫—Ç–æ—Ä–∏–Ω—ã (Quiz) --- */
        
        #quiz-container h1, #quiz-container p {
            width: 100%;
            background-color: transparent; 
            box-shadow: none;
            padding: 0;
            margin: 0;
            margin-bottom: 10px;
        }

        #question-area {
            font-size: 1.2em;
            font-weight: bold; 
            color: var(--color-blue); 
            padding: 20px;
            border-radius: 8px;
            background-color: rgba(255, 255, 255, 0.9);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            margin-bottom: 15px;
            width: 100%; 
        }

        #answer-row {
            padding: 15px;
            border: 2px solid #ccc;
            min-height: 40px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.8em;
            font-weight: bold; 
            text-transform: uppercase;
            letter-spacing: 2px;
            overflow: hidden; 
            background-color: rgba(255, 255, 255, 0.9);
            border-radius: 8px;
            width: 100%; 
            margin-bottom: 15px;
        }
        
        #keyboard {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            margin-top: 10px;
            padding: 10px;
            width: 100%; 
        }
        
        .keyboard-row {
            display: flex;
            gap: 6px;
            justify-content: center;
            width: 100%;
        }

        .key {
            background-color: var(--color-unused);
            color: var(--color-text);
            border: none;
            border-radius: 4px;
            padding: 10px 0;
            cursor: pointer;
            font-weight: normal; 
            text-transform: uppercase;
            flex-grow: 1;
            min-width: 30px;
            max-width: 45px;
            transition: background-color 0.1s;
        }

        .key.big {
            padding: 10px 15px;
            flex-grow: 1.8; 
            max-width: none; 
        }
        
        .key:active {
            filter: brightness(0.9);
        }
        
        #message-area {
            font-size: 1.1em;
            font-weight: bold;
            min-height: 25px;
            text-align: center;
            margin-top: 5px;
            width: 100%;
        }

        #cooldown-area {
            font-size: 1em;
            font-weight: bold;
            color: var(--color-blue); 
            min-height: 20px;
            margin-top: 10px;
            width: 100%;
        }

        /* –¶–≤–µ—Ç–∞ —Å–æ–æ–±—â–µ–Ω–∏–π */
        .message-success {
            color: var(--color-correct) !important; 
        }

        .message-error {
            color: #FF0000 !important; 
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ */
        #secret-trigger { width: 80%; max-width: 400px; height: 20px; margin-top: -10px; margin-bottom: 10px; z-index: 10; cursor: pointer; }
        #admin-modal { display: none; position: fixed; z-index: 100; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.8); }
        .modal-content { 
            background-color: #fefefe; margin: 5% auto; padding: 20px; border: 1px solid #888; width: 80%; 
            max-width: 900px; border-radius: 8px; color: var(--color-text); box-shadow: 0 0 10px rgba(0,0,0,0.5); 
            max-height: 90vh; display: flex; flex-direction: column; 
        }
        .modal-content h2 { margin-top: 0; padding-bottom: 10px; flex-shrink: 0; }
        .close { color: #aaa; float: right; font-size: 28px; font-weight: bold; cursor: pointer; }
        .close:hover, .close:focus { color: #000; text-decoration: none; cursor: pointer; }
        
        .admin-tabs { margin-bottom: 10px; border-bottom: 2px solid #ccc; display: flex; }
        .admin-tab-button {
            padding: 10px 15px;
            cursor: pointer;
            border: 1px solid transparent;
            border-bottom: none;
            margin-right: 5px;
            background-color: #f4f4f4;
            border-radius: 4px 4px 0 0;
            transition: background-color 0.3s;
        }
        .admin-tab-button:hover { background-color: #eee; }

        #word-list-container, #log-list-container { overflow-y: auto; max-height: 400px; margin-top: 10px; flex-grow: 1; }
        
        #word-list-table, #log-list-table { width: 100%; border-collapse: collapse; font-size: 0.9em; position: relative; }
        #word-list-table th, #word-list-table td, #log-list-table th, #log-list-table td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        #word-list-table th, #log-list-table th { background-color: #f2f2f2; position: sticky; top: 0; z-index: 2; }
        .today-row { background-color: #d4edda; font-weight: bold; }
    </style>
</head>
<body>

    <div id="auth-container" class="game-section">
        <h1>üëã –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!</h1>
        <p>–î–ª—è –Ω–∞—á–∞–ª–∞ –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã –≤–≤–µ–¥–∏—Ç–µ —Å–≤–æ–µ –ò–º—è –∏ –§–∞–º–∏–ª–∏—é.</p>
        
        <div class="auth-input-group">
            <label for="fullName">–ò–º—è –∏ –§–∞–º–∏–ª–∏—è</label>
            <input type="text" id="fullName" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, –ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤" autocomplete="off">
        </div>
        
        <button id="continue-button">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
        <div id="auth-message-area" style="color: red; margin-top: 10px;"></div>
    </div>

    <div id="quiz-container" class="game-section">
        <h1 id="main-title">üß† –î–µ—Ç—Å–∫–∞—è –í–∏–∫—Ç–æ—Ä–∏–Ω–∞ üí°</h1>
        <p id="welcome-message"></p>
        
        <div id="secret-trigger"></div>

        <div id="question-area"></div>
        
        <div id="answer-row"></div> 

        <div id="message-area"></div>
        
        <div id="keyboard">
            </div>
        
        <div id="cooldown-area"></div>
    </div>

    <div id="admin-modal" style="display: none;">
      <div class="modal-content">
        <span class="close" onclick="document.getElementById('admin-modal').style.display='none'">&times;</span>
        <h2>–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–∞—è –ø–∞–Ω–µ–ª—å ü§´</h2>
        
        <div class="admin-tabs">
            <div class="admin-tab-button" id="tab-questions" onclick="switchAdminTab('questions')" style="font-weight: bold;">–°–ø–∏—Å–æ–∫ –≤–æ–ø—Ä–æ—Å–æ–≤</div>
            <div class="admin-tab-button" id="tab-logs" onclick="switchAdminTab('logs')">–ò—Å—Ç–æ—Ä–∏—è –∏–≥—Ä</div>
        </div>

        <div id="quiz-list-view">
            <div id="word-list-container">
                <table id="word-list-table">
                  <thead>
                    <tr>
                      <th>–î–∞—Ç–∞</th>
                      <th>–í–æ–ø—Ä–æ—Å</th>
                      <th>–û—Ç–≤–µ—Ç</th>
                    </tr>
                  </thead>
                  <tbody id="word-list-body">
                    </tbody>
                </table>
            </div>
        </div>
        
        <div id="log-list-view" style="display: none;">
            <div id="log-list-container">
                <table id="log-list-table">
                  <thead>
                    <tr>
                      <th>–î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è</th>
                      <th>–ò–º—è</th>
                      <th>–í–æ–ø—Ä–æ—Å (–Ω–∞—á.)</th>
                      <th>–û—Ç–≤–µ—Ç</th>
                      <th>–ü–æ–ø—ã—Ç–æ–∫</th>
                      <th>–°—Ç–∞—Ç—É—Å</th>
                    </tr>
                  </thead>
                  <tbody id="log-list-body">
                    </tbody>
                </table>
            </div>
        </div>
        
      </div>
    </div>

    <script>
        // ====================================================================
        // –ö–û–ù–°–¢–ê–ù–¢–´ –ò –ë–ê–ó–ê –î–ê–ù–ù–´–•
        // ====================================================================
        const QUIZ_DATABASE = [
            { question: '–ö–∞–∫–æ–π —ç–ª–µ–º–µ–Ω—Ç –≤ –º–∞—Ç–µ–º–∞—Ç–∏–∫–µ —Å–∫–ª–∞–¥—ã–≤–∞–µ—Ç —á–∏—Å–ª–∞?', answer: '–°–õ–û–ñ–ï–ù–ò–ï' },
            { question: '–ö–∞–∫ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è –≤–æ–¥–∞, –∫–æ—Ç–æ—Ä–∞—è –ø–∞–¥–∞–µ—Ç —Å –Ω–µ–±–∞ –≤ –≤–∏–¥–µ –∫–∞–ø–µ–ª—å?', answer: '–î–û–ñ–î–¨' },
            { question: '–ö–∞–∫–æ–π —Ü–≤–µ—Ç –ø–æ–ª—É—á–∏—Ç—Å—è, –µ—Å–ª–∏ —Å–º–µ—à–∞—Ç—å —Å–∏–Ω–∏–π –∏ –∂–µ–ª—Ç—ã–π?', answer: '–ó–ï–õ–Å–ù–´–ô' },
            { question: '–ö–∞–∫ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è —á–µ–ª–æ–≤–µ–∫, –∫–æ—Ç–æ—Ä—ã–π –ª–µ—Ç–∏—Ç –≤ –∫–æ—Å–º–æ—Å?', answer: '–ö–û–°–ú–û–ù–ê–í–¢' },
            { question: '–ö–∞–∫–æ–π –∑–≤–µ—Ä—å –∑–∏–º–æ–π —Å–ø–∏—Ç –≤ –±–µ—Ä–ª–æ–≥–µ?', answer: '–ú–ï–î–í–ï–î–¨' },
            { question: '–°–∞–º–∞—è –±–æ–ª—å—à–∞—è –ø–ª–∞–Ω–µ—Ç–∞ –≤ –Ω–∞—à–µ–π —Å–æ–ª–Ω–µ—á–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ?', answer: '–Æ–ü–ò–¢–ï–†' },
            { question: '–ß—Ç–æ –∑–∞—â–∏—â–∞–µ—Ç –≥–æ–ª–æ–≤—É –≤–µ–ª–æ—Å–∏–ø–µ–¥–∏—Å—Ç–∞?', answer: '–®–õ–ï–ú' },
        ];

        const MAX_ATTEMPTS = 2; 
        const COOLDOWN_MS = 5 * 1000; // –¢–∞–π–º–µ—Ä –Ω–∞ 5 —Å–µ–∫—É–Ω–¥
        const REQUIRED_CLICKS = 5; 

        // ====================================================================
        // –°–¢–ê–¢–£–° –ò–ì–†–´ (–û–ë–ù–û–í–õ–ï–ù–û: –î–û–ë–ê–í–õ–ï–ù gameLogs)
        // ====================================================================
        let state = {
            currentGuess: '',
            targetAnswer: '', 
            targetQuestion: '', 
            attemptsCount: 0,
            lastFailedTime: 0,
            isLocked: false,
            gameStatus: 'playing', 
            userName: '', 
            gameLogs: JSON.parse(localStorage.getItem('quizGameLogs')) || [] 
        };
        
        let secretClickCount = 0;
        let clickTimeout = null; 

        // –≠–ª–µ–º–µ–Ω—Ç—ã DOM –¥–ª—è –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        const authContainer = document.getElementById('auth-container');
        const fullNameInput = document.getElementById('fullName');
        const continueButton = document.getElementById('continue-button');
        const authMessageArea = document.getElementById('auth-message-area');
        
        // –≠–ª–µ–º–µ–Ω—Ç—ã DOM –¥–ª—è –í–∏–∫—Ç–æ—Ä–∏–Ω—ã
        const quizContainer = document.getElementById('quiz-container');
        const welcomeMessage = document.getElementById('welcome-message');
        const questionArea = document.getElementById('question-area');
        const answerRow = document.getElementById('answer-row');
        const keyboardElement = document.getElementById('keyboard');
        const messageArea = document.getElementById('message-area');
        const cooldownArea = document.getElementById('cooldown-area');
        const adminModal = document.getElementById('admin-modal');
        const secretTrigger = document.getElementById('secret-trigger');


        // --- –§–£–ù–ö–¶–ò–ò –ê–í–¢–û–†–ò–ó–ê–¶–ò–ò ---

        function handleContinue() {
            const fullName = fullNameInput.value.trim();

            if (fullName.length < 5 || fullName.split(/\s+/).length < 2) {
                authMessageArea.textContent = '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –ò–º—è –∏ –§–∞–º–∏–ª–∏—é (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤).';
                return;
            }

            state.userName = fullName;
            localStorage.setItem('quizUserName', state.userName);

            authContainer.style.display = 'none';
            quizContainer.style.display = 'flex'; 

            const firstName = fullName.split(/\s+/)[0];
            welcomeMessage.textContent = `–ü—Ä–∏–≤–µ—Ç, ${firstName}! –£–≥–∞–¥–∞–π –∑–∞–≥–∞–¥–∞–Ω–Ω–æ–µ —Å–ª–æ–≤–æ. –£ —Ç–µ–±—è –≤—Å–µ–≥–æ 2 –ø–æ–ø—ã—Ç–∫–∏!`;
            
            initGameContent();
        }

        function checkAuthStatus() {
            const savedName = localStorage.getItem('quizUserName');
            if (savedName) {
                state.userName = savedName;
                
                authContainer.style.display = 'none';
                quizContainer.style.display = 'flex';
                
                const firstName = savedName.split(/\s+/)[0] || savedName;
                welcomeMessage.textContent = `–ü—Ä–∏–≤–µ—Ç, ${firstName}! –£–≥–∞–¥–∞–π –∑–∞–≥–∞–¥–∞–Ω–Ω–æ–µ —Å–ª–æ–≤–æ. –£ —Ç–µ–±—è –≤—Å–µ–≥–æ 2 –ø–æ–ø—ã—Ç–∫–∏!`;
                
                initGameContent();
            } else {
                authContainer.style.display = 'flex';
                quizContainer.style.display = 'none';
                continueButton.addEventListener('click', handleContinue);
                
                fullNameInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        handleContinue();
                    }
                });
            }
        }
        
        // --- –ù–û–í–´–ï –§–£–ù–ö–¶–ò–ò –î–õ–Ø –õ–û–ì–ò–†–û–í–ê–ù–ò–Ø ---
        function saveGameLog(status) {
            const today = new Date();
            
            const logEntry = {
                date: today.toLocaleDateString('ru-RU'),
                time: today.toLocaleTimeString('ru-RU'),
                userName: state.userName,
                question: state.targetQuestion,
                answer: state.targetAnswer,
                attempts: state.attemptsCount,
                status: status, 
            };
            
            state.gameLogs.unshift(logEntry);
            
            // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π
            if (state.gameLogs.length > 50) {
                state.gameLogs.pop();
            }
            
            localStorage.setItem('quizGameLogs', JSON.stringify(state.gameLogs));
        }

        // --- –§–£–ù–ö–¶–ò–ò –ê–î–ú–ò–ù-–ü–ê–ù–ï–õ–ò (–û–ë–ù–û–í–õ–ï–ù–û) ---
        function getDailyQuiz(date = new Date()) {
            const start = new Date(2024, 0, 1);
            const today = new Date(date.getFullYear(), date.getMonth(), date.getDate());
            const startDay = new Date(start.getFullYear(), start.getMonth(), start.getDate());
            const diffTime = Math.abs(today - startDay);
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            const index = diffDays % QUIZ_DATABASE.length;
            return QUIZ_DATABASE[index];
        }

        function generateWordList() {
            const wordListBody = document.getElementById('word-list-body');
            wordListBody.innerHTML = '';
            const today = new Date();
            for (let i = -7; i <= 7; i++) {
                const date = new Date(today);
                date.setDate(today.getDate() + i);
                const quiz = getDailyQuiz(date);
                const dateFormatted = date.toLocaleDateString('ru-RU', { day: '2-digit', month: '2-digit', year: 'numeric' });
                const row = wordListBody.insertRow();
                if (i === 0) { row.className = 'today-row'; }
                row.insertCell().textContent = dateFormatted;
                row.insertCell().textContent = quiz.question;
                row.insertCell().textContent = quiz.answer;
            }
        }
        
        function generateLogList() {
            const logListBody = document.getElementById('log-list-body');
            logListBody.innerHTML = '';
            
            if (state.gameLogs.length === 0) {
                logListBody.innerHTML = '<tr><td colspan="6" style="text-align: center; color: #777;">–ò—Å—Ç–æ—Ä–∏—è –∏–≥—Ä –ø—É—Å—Ç–∞.</td></tr>';
                return;
            }

            state.gameLogs.forEach(log => {
                const row = logListBody.insertRow();
                
                if (log.status === '–ü–æ–±–µ–¥–∞') {
                     row.style.backgroundColor = '#d4edda'; 
                } else if (log.status === '–ü—Ä–æ–∏–≥—Ä—ã—à') {
                     row.style.backgroundColor = '#f8d7da'; 
                }
                
                row.insertCell().textContent = log.date + ' ' + log.time;
                row.insertCell().textContent = log.userName.split(/\s+/)[0]; 
                row.insertCell().textContent = log.question.substring(0, 30) + '...';
                row.insertCell().textContent = log.answer;
                row.insertCell().textContent = log.attempts;
                row.insertCell().textContent = log.status;
            });
        }

        window.showAdminPanel = function() {
            generateWordList(); 
            generateLogList();  
            adminModal.style.display = 'block';
            switchAdminTab('questions'); 
        }

        window.switchAdminTab = function(tabName) {
            document.getElementById('quiz-list-view').style.display = tabName === 'questions' ? 'block' : 'none';
            document.getElementById('log-list-view').style.display = tabName === 'logs' ? 'block' : 'none';
            
            document.getElementById('tab-questions').style.fontWeight = tabName === 'questions' ? 'bold' : 'normal';
            document.getElementById('tab-logs').style.fontWeight = tabName === 'logs' ? 'bold' : 'normal';
        }

        function handleSecretClick() {
            clearTimeout(clickTimeout); 
            secretClickCount++;
            if (secretClickCount >= REQUIRED_CLICKS) {
                showAdminPanel();
                secretClickCount = 0; 
                return;
            }
            clickTimeout = setTimeout(() => {
                secretClickCount = 0;
            }, 1000); 
        }
        // --- –ö–û–ù–ï–¶ –§–£–ù–ö–¶–ò–ô –ê–î–ú–ò–ù-–ü–ê–ù–ï–õ–ò ---

        // --- –ó–∞–≥—Ä—É–∑–∫–∞ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è ---
        function loadGameState() {
            const dailyQuiz = getDailyQuiz();
            const savedState = JSON.parse(localStorage.getItem('quizGameState'));
            
            state.targetAnswer = dailyQuiz.answer;
            state.targetQuestion = dailyQuiz.question;

            if (savedState && savedState.targetAnswer === dailyQuiz.answer) {
                state = { ...state, ...savedState };
                if (state.lastFailedTime && Date.now() - state.lastFailedTime < COOLDOWN_MS) {
                     state.isLocked = true;
                     state.gameStatus = 'locked';
                }
            } else {
                state.attemptsCount = 0;
                state.lastFailedTime = 0;
                state.gameStatus = 'playing';
            }
            
            checkLockStatus();
        }

        function saveGameState() {
            localStorage.setItem('quizGameState', JSON.stringify({
                currentGuess: state.currentGuess,
                targetAnswer: state.targetAnswer,
                targetQuestion: state.targetQuestion,
                attemptsCount: state.attemptsCount,
                lastFailedTime: state.lastFailedTime,
                isLocked: state.isLocked,
                gameStatus: state.gameStatus,
            }));
        }
        
        // --- –°–±—Ä–æ—Å –∏–≥—Ä—ã –ø–æ—Å–ª–µ —Ç–∞–π–º–µ—Ä–∞ ---
        function resetGameAfterCooldown() {
            state.attemptsCount = 0;
            state.currentGuess = '';
            state.lastFailedTime = 0;
            state.isLocked = false;
            state.gameStatus = 'playing';
            
            messageArea.textContent = '';
            
            drawQuestionAndAnswer();
            drawKeyboard();
            
            showMessage('–¢–∞–π–º–µ—Ä —Å—Ä–∞–±–æ—Ç–∞–ª! –ò–≥—Ä–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–±—Ä–æ—à–µ–Ω–∞. –ù–∞—á–Ω–∏—Ç–µ –Ω–æ–≤—É—é –ø–æ–ø—ã—Ç–∫—É.', false);
            saveGameState();
        }


        // --- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–∞–π–º–µ—Ä–∞ ---
        function checkLockStatus() {
            if (state.lastFailedTime) {
                const timePassed = Date.now() - state.lastFailedTime;
                if (timePassed < COOLDOWN_MS) {
                    state.isLocked = true;
                    state.gameStatus = 'locked';
                    
                    const remainingTime = COOLDOWN_MS - timePassed;
                    const totalSeconds = Math.ceil(remainingTime / 1000);
                    
                    cooldownArea.textContent = `–î–æ —Å–ª–µ–¥—É—é—â–µ–π –ø–æ–ø—ã—Ç–∫–∏: ${totalSeconds} —Å–µ–∫—É–Ω–¥`;
                    
                    requestAnimationFrame(checkLockStatus);
                    return true;
                } else {
                    cooldownArea.textContent = '';
                    resetGameAfterCooldown();
                    return false;
                }
            }
            state.isLocked = false;
            if (state.gameStatus === 'locked') {
                 state.gameStatus = 'playing';
            }
            cooldownArea.textContent = '';
            return false;
        }

        // --- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è ---
        function showMessage(msg, isError = false) {
            messageArea.textContent = msg;
            
            messageArea.classList.remove('message-success', 'message-error');
            messageArea.classList.add(isError ? 'message-error' : 'message-success');
            
            if (state.gameStatus !== 'lost' && state.gameStatus !== 'won') {
                 setTimeout(() => {
                    messageArea.textContent = '';
                    messageArea.classList.remove('message-success', 'message-error');
                }, isError ? 5000 : 2000);
            }
        }
        
        // --- –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –≤–æ–ø—Ä–æ—Å–∞ –∏ —Å—Ç—Ä–æ–∫–∏ –æ—Ç–≤–µ—Ç–∞ ---
        function drawQuestionAndAnswer() {
            questionArea.textContent = state.targetQuestion;
            
            if (state.gameStatus === 'lost' || state.gameStatus === 'locked') {
                answerRow.textContent = '‚ùå'; 
            } else if (state.gameStatus === 'won') {
                answerRow.textContent = state.targetAnswer + ' ‚úÖ';
            } else {
                answerRow.textContent = state.currentGuess;
            }
        }

        // --- –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã ---
        function drawKeyboard() {
            const layout = [
                '–ô –¶ –£ –ö –ï –ù –ì –® –© –ó –• –™',
                '–§ –´ –í –ê –ü –† –û –õ –î –ñ –≠',
                '–Ø –ß –° –ú –ò –¢ –¨ –ë –Æ'
            ];
            keyboardElement.innerHTML = '';
            
            layout.forEach(rowString => {
                const row = document.createElement('div');
                row.className = 'keyboard-row';
                
                if (rowString.startsWith('–Ø')) {
                    const del = document.createElement('button');
                    del.textContent = '‚å´';
                    del.className = 'key big';
                    del.onclick = () => handleInput('Backspace');
                    row.appendChild(del);
                }
                
                rowString.split(' ').forEach(letter => {
                    const key = document.createElement('button');
                    key.textContent = letter;
                    key.className = 'key';
                    key.onclick = () => handleInput(letter);
                    row.appendChild(key);
                });
                
                if (rowString.startsWith('–Ø')) {
                    const enter = document.createElement('button');
                    enter.textContent = '–í–≤–æ–¥';
                    enter.className = 'key big'; 
                    enter.onclick = () => handleInput('Enter');
                    row.appendChild(enter);
                }

                keyboardElement.appendChild(row);
            });
        }
        
        // --- –õ–æ–≥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ—Ç–≤–µ—Ç–∞ (–û–ë–ù–û–í–õ–ï–ù–û: –î–û–ë–ê–í–õ–ï–ù saveGameLog) ---
        function checkGuess() {
            if (state.isLocked) return; 

            const guess = state.currentGuess.toUpperCase().replace(/–Å/g, '–ï');
            const target = state.targetAnswer.toUpperCase().replace(/–Å/g, '–ï');
            
            state.attemptsCount++;

            // --- –õ–û–ì–ò–ö–ê –ü–û–ë–ï–î–´ ---
            if (guess === target) {
                state.gameStatus = 'won';
                saveGameState();
                showMessage(`–ü—Ä–∞–≤–∏–ª—å–Ω–æ! –û—Ç–≤–µ—Ç: ${state.targetAnswer}! üéâ`, false); 
                saveGameLog('–ü–æ–±–µ–¥–∞'); // <--- –õ–û–ì–ò–†–û–í–ê–ù–ò–ï –ü–û–ë–ï–î–´
            } else {
                // --- –õ–û–ì–ò–ö–ê –ù–ï–£–î–ê–ß–ò ---
                if (state.attemptsCount < MAX_ATTEMPTS) {
                    showMessage(`–ù–µ–≤–µ—Ä–Ω–æ. –ü–æ–ø—ã—Ç–æ–∫ –æ—Å—Ç–∞–ª–æ—Å—å: ${MAX_ATTEMPTS - state.attemptsCount}`, true);
                    state.currentGuess = ''; 
                } else {
                    // –ü–æ—Å–ª–µ–¥–Ω—è—è –ø–æ–ø—ã—Ç–∫–∞ - –ü—Ä–æ–∏–≥—Ä—ã—à
                    state.gameStatus = 'lost';
                    
                    state.lastFailedTime = Date.now();
                    state.isLocked = true;
                    state.gameStatus = 'locked';
                    
                    showMessage(`–¢—ã –Ω–µ —É–≥–∞–¥–∞–ª. üíî –ò–≥—Ä–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞ —Ç–∞–π–º–µ—Ä–æ–º.`, true);
                    checkLockStatus(); 
                    saveGameLog('–ü—Ä–æ–∏–≥—Ä—ã—à'); // <--- –õ–û–ì–ò–†–û–í–ê–ù–ò–ï –ü–†–û–ò–ì–†–´–®–ê
                }
                saveGameState();
            }
        }
        
        // --- –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–≤–æ–¥–∞ ---
        function handleInput(key) {
            const canPlay = !state.isLocked && state.gameStatus !== 'won';

            if (!canPlay) {
                if (state.isLocked) showMessage(`–ò–≥—Ä–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞. –î–æ–∂–¥–∏—Ç–µ—Å—å –æ–∫–æ–Ω—á–∞–Ω–∏—è —Ç–∞–π–º–µ—Ä–∞.`, true);
                return;
            }
            
            const letter = key.toUpperCase();

            if (letter === 'ENTER') {
                if (state.currentGuess.trim().length > 0) {
                    checkGuess();
                } else {
                    showMessage(`–í–≤–µ–¥–∏—Ç–µ –æ—Ç–≤–µ—Ç!`, true);
                }
            } else if (letter === 'BACKSPACE' || letter === 'DELETE') {
                state.currentGuess = state.currentGuess.slice(0, -1);
            } else if (letter.length === 1 && '–ê–ë–í–ì–î–ï–Å–ñ–ó–ò–ô–ö–õ–ú–ù–û–ü–†–°–¢–£–§–•–¶–ß–®–©–™–´–¨–≠–Æ–Ø'.includes(letter)) {
                state.currentGuess += letter;
            }
            drawQuestionAndAnswer(); 
        }

        // --- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ò–ì–†–û–í–û–ì–û –ö–û–ù–¢–ï–ù–¢–ê ---
        function initGameContent() {
            loadGameState();
            drawQuestionAndAnswer();
            drawKeyboard();
            checkLockStatus();
            
            secretTrigger.addEventListener('click', handleSecretClick);
            
            document.addEventListener('keyup', (e) => {
                const isQuizActive = quizContainer.style.display === 'flex';
                const canPlay = !state.isLocked && state.gameStatus !== 'won';
                
                if (e.key === 'Escape' && adminModal.style.display === 'block') {
                    adminModal.style.display = 'none';
                    return;
                }

                if (isQuizActive && canPlay) {
                    if (e.key === 'Enter') {
                        handleInput('Enter');
                    } else if (e.key === 'Backspace') {
                        handleInput('Backspace');
                    } else if (e.key.length === 1) { 
                        if ('–ê–ë–í–ì–î–ï–Å–ñ–ó–ò–ô–ö–õ–ú–ù–û–ü–†–°–¢–£–§–•–¶–ß–®–©–™–´–¨–≠–Æ–Ø'.includes(e.key.toUpperCase())) {
                            handleInput(e.key);
                        }
                    }
                }
            });
        }
        
        // --- –ì–õ–û–ë–ê–õ–¨–ù–ê–Ø –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ---
        function init() {
            window.onclick = function(event) {
                if (event.target == adminModal) {
                    adminModal.style.display = 'none';
                }
            }
            checkAuthStatus();
        }

        // –ó–∞–ø—É—Å–∫!
        init();

    </script>
</body>
</html>