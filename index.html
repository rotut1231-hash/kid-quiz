<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–î–µ—Ç—Å–∫–∞—è –í–∏–∫—Ç–æ—Ä–∏–Ω–∞ (Wordle-–ö–ª–æ–Ω)</title>
    <style>
        :root {
            /* –¶–≤–µ—Ç–æ–≤–∞—è —Å—Ö–µ–º–∞ */
            --tile-size: 50px;
            --color-correct: #6AAA64; /* –ó–µ–ª–µ–Ω—ã–π */
            --color-present: #C9B458; /* –ñ–µ–ª—Ç—ã–π */
            --color-absent: #787C7E; /* –°–µ—Ä—ã–π */
            --color-unused: #D3D6DA; /* –°–≤–µ—Ç–ª–æ-—Å–µ—Ä—ã–π */
            --color-keyboard-bg: #818384;
            --color-bg: #FFFFFF;
            --color-text: #202020;
        }

        body {
            font-family: Arial, sans-serif;
            margin: 0;
            background-color: var(--color-bg);
            color: var(--color-text);
            
            /* –ù–û–í–´–ô CSS –î–õ–Ø –í–´–†–ê–í–ù–ò–í–ê–ù–ò–Ø –ü–û –¶–ï–ù–¢–†–£ */
            display: flex;
            flex-direction: column;
            justify-content: center; /* –¶–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ –≤–µ—Ä—Ç–∏–∫–∞–ª–∏ */
            align-items: center; /* –¶–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–∏ */
            min-height: 100vh; /* –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –≤—ã—Å–æ—Ç–∞ - –≤–µ—Å—å —ç–∫—Ä–∞–Ω */
            padding: 20px; /* –î–æ–±–∞–≤–∏–º –Ω–µ–±–æ–ª—å—à–æ–π –æ—Ç—Å—Ç—É–ø, —á—Ç–æ–±—ã –∫–æ–Ω—Ç–µ–Ω—Ç –Ω–µ –ø—Ä–∏–ª–∏–ø–∞–ª –∫ –∫—Ä–∞—è–º */
            box-sizing: border-box;
            /* –ö–û–ù–ï–¶ –ù–û–í–û–ì–û CSS */
        }

        h1 {
            font-size: 1.5em;
            margin-bottom: 5px; /* –£–º–µ–Ω—å—à–∏–º –æ—Ç—Å—Ç—É–ø */
            text-align: center;
        }

        p {
            margin-top: 5px;
            margin-bottom: 20px;
            text-align: center;
        }

        #game-board {
            /* 2 —Å—Ç—Ä–æ–∫–∏ */
            display: grid;
            grid-template-rows: repeat(2, var(--tile-size)); 
            gap: 5px;
            margin-bottom: 20px;
        }

        .row {
            display: grid;
            grid-template-columns: repeat(5, var(--tile-size)); /* 5 –±—É–∫–≤ */
            gap: 5px;
        }

        .tile {
            width: var(--tile-size);
            height: var(--tile-size);
            border: 2px solid var(--color-absent);
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.5em;
            font-weight: bold;
            text-transform: uppercase;
            box-sizing: border-box;
            background-color: transparent;
            color: var(--color-text);
            transition: background-color 0.5s, border-color 0.5s;
        }

        .tile.correct { background-color: var(--color-correct); border-color: var(--color-correct); color: white; }
        .tile.present { background-color: var(--color-present); border-color: var(--color-present); color: white; }
        .tile.absent { background-color: var(--color-absent); border-color: var(--color-absent); color: white; }
        .tile.filled { border-color: var(--color-text); }

        #keyboard {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            margin-top: 20px;
            width: 100%;
            max-width: 500px;
        }

        .keyboard-row {
            display: flex;
            gap: 6px;
            justify-content: center;
            width: 100%;
        }

        .key {
            background-color: var(--color-unused);
            color: var(--color-text);
            border: none;
            border-radius: 4px;
            padding: 10px 0;
            cursor: pointer;
            font-weight: bold;
            text-transform: uppercase;
            flex-grow: 1;
            min-width: 30px;
            max-width: 45px;
            transition: background-color 0.1s;
        }

        .key.big {
            padding: 10px 15px;
            flex-grow: 1.5;
        }

        .key:active {
            filter: brightness(0.9);
        }
        
        /* –¶–≤–µ—Ç–∞ –Ω–∞ –∫–ª–∞–≤–∏–∞—Ç—É—Ä–µ */
        .key.correct { background-color: var(--color-correct); color: white; }
        .key.present { background-color: var(--color-present); color: white; }
        .key.absent { background-color: var(--color-absent); color: white; }

        #message-area {
            margin-top: 20px;
            font-size: 1.1em;
            font-weight: bold;
            color: #FF0000; /* –ö—Ä–∞—Å–Ω—ã–π –¥–ª—è –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π */
            min-height: 25px;
            text-align: center;
        }
    </style>
</head>
<body>

    <h1>üß† –î–µ—Ç—Å–∫–∞—è –í–∏–∫—Ç–æ—Ä–∏–Ω–∞ üí°</h1>
    <p>–£–≥–∞–¥–∞–π —Å–ª–æ–≤–æ –∏–∑ 5 –±—É–∫–≤. –£ —Ç–µ–±—è –≤—Å–µ–≥–æ 2 –ø–æ–ø—ã—Ç–∫–∏!</p>

    <div id="game-board">
        </div>

    <div id="message-area"></div>

    <div id="keyboard">
        </div>

    <script>
        // ====================================================================
        // –ë–ê–ó–ê –î–ê–ù–ù–´–• –°–õ–û–í (–ò–º–∏—Ç–∞—Ü–∏—è)
        // ====================================================================
        const WORDS_DATABASE = [
            '–ö–û–®–ö–ê', '–°–û–ë–ê–ö', '–†–´–ë–ö–ê', '–ö–ù–ò–ì–ê', '–†–£–ß–ö–ê',
            '–°–¢–û–õ–ë', '–ü–û–ï–ó–î', '–¢–†–ê–í–ê', '–¶–í–ï–¢–û–ö', '–ü–ê–†–¢–ê',
            '–®–ö–û–õ–ê', '–°–ï–ö–†–ï–¢', '–ò–ì–†–ê–¢', '–ñ–ò–†–ê–§', '–°–õ–û–ù–ê',
            '–°–û–õ–ù–¶', '–õ–£–ù–ê–ú', '–ó–í–ï–ó–î', '–ù–ï–ë–û–°', '–°–ö–ê–ó–ö'
        ];
        const WORD_LENGTH = 5;
        const MAX_ATTEMPTS = 2; 
        const COOLDOWN_HOURS = 4;
        const COOLDOWN_MS = COOLDOWN_HOURS * 60 * 60 * 1000; // 4 —á–∞—Å–∞ –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö

        // ====================================================================
        // –°–¢–ê–¢–£–° –ò–ì–†–´
        // ====================================================================
        let state = {
            currentGuess: '',
            attempts: [], 
            targetWord: '',
            attemptsCount: 0,
            lastFailedTime: 0,
            isLocked: false,
            gameStatus: 'playing', // 'playing', 'won', 'lost', 'locked'
            lossCount: 0 
        };

        const boardElement = document.getElementById('game-board');
        const keyboardElement = document.getElementById('keyboard');
        const messageArea = document.getElementById('message-area');

        // --- –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ª–æ–≤–∞ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è—à–Ω–∏–π –¥–µ–Ω—å ---
        function getDailyWord() {
            const start = new Date(2024, 0, 1);
            const today = new Date();
            const diffTime = Math.abs(today - start);
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            
            const index = diffDays % WORDS_DATABASE.length;
            return WORDS_DATABASE[index];
        }

        // --- –ó–∞–≥—Ä—É–∑–∫–∞ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–≥—Ä—ã –∏–∑ localStorage ---
        function loadGameState() {
            const savedState = JSON.parse(localStorage.getItem('kidWordleState'));
            
            state.lossCount = parseInt(localStorage.getItem('kidWordleLossCount') || '0', 10);
            
            const dailyWord = getDailyWord();

            if (savedState && savedState.targetWord === dailyWord) {
                state = { ...state, ...savedState };
            } else {
                state.targetWord = dailyWord;
                state.attempts = [];
                state.attemptsCount = 0;
                state.lastFailedTime = 0;
                state.gameStatus = 'playing';
                state.lossCount = parseInt(localStorage.getItem('kidWordleLossCount') || '0', 10);
            }

            checkCooldown();
        }

        // --- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–≥—Ä—ã –≤ localStorage ---
        function saveGameState() {
            localStorage.setItem('kidWordleState', JSON.stringify({
                ...state,
                lossCount: undefined
            }));
            localStorage.setItem('kidWordleLossCount', state.lossCount);
        }
        
        // --- –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω–æ–π –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ (4 —á–∞—Å–∞) ---
        function checkCooldown() {
            if (state.lossCount >= 2 && state.lastFailedTime) {
                const timePassed = Date.now() - state.lastFailedTime;
                if (timePassed < COOLDOWN_MS) {
                    state.isLocked = true;
                    state.gameStatus = 'locked';
                    const remainingTime = COOLDOWN_MS - timePassed;
                    const hours = Math.floor(remainingTime / (1000 * 60 * 60));
                    const minutes = Math.floor((remainingTime % (1000 * 60 * 60)) / (1000 * 60));
                    showMessage(`–ò–≥—Ä–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞. –î–≤–µ –Ω–µ—É–¥–∞—á–∏ –ø–æ–¥—Ä—è–¥ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–ª–∏ —Ç–∞–π–º–µ—Ä. –°–ª–µ–¥—É—é—â–∞—è –ø–æ–ø—ã—Ç–∫–∞ —á–µ—Ä–µ–∑ ${hours} —á. ${minutes} –º–∏–Ω.`, true);
                    return true;
                } else {
                    state.lastFailedTime = 0;
                    state.isLocked = false;
                    state.gameStatus = 'playing';
                    state.lossCount = 0; 
                    saveGameState();
                    showMessage('–°–Ω–æ–≤–∞ –º–æ–∂–Ω–æ –∏–≥—Ä–∞—Ç—å!');
                }
            }
            return state.isLocked;
        }

        // --- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è ---
        function showMessage(msg, isError = false) {
            messageArea.textContent = msg;
            messageArea.style.color = isError ? 'red' : 'blue';
            setTimeout(() => {
                if (!state.isLocked) {
                    messageArea.textContent = '';
                }
            }, isError ? 5000 : 2000);
        }

        // --- –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Å–µ—Ç–∫–∏ (–¥–æ—Å–∫–∏) ---
        function drawBoard() {
            boardElement.innerHTML = '';
            for (let i = 0; i < MAX_ATTEMPTS; i++) {
                const row = document.createElement('div');
                row.className = 'row';
                for (let j = 0; j < WORD_LENGTH; j++) {
                    const tile = document.createElement('div');
                    tile.className = 'tile';
                    if (state.attempts[i]) {
                        const letter = state.attempts[i].word[j];
                        const status = state.attempts[i].status[j];
                        tile.textContent = letter;
                        tile.classList.add(status);
                    } else if (i === state.attempts.length && state.gameStatus === 'playing') {
                        if (state.currentGuess[j]) {
                            tile.textContent = state.currentGuess[j];
                            tile.classList.add('filled');
                        } else {
                            tile.textContent = '';
                        }
                    }
                    row.appendChild(tile);
                }
                boardElement.appendChild(row);
            }
        }

        // --- –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã ---
        function drawKeyboard() {
            const layout = [
                '–ô –¶ –£ –ö –ï –ù –ì –® –© –ó –• –™',
                '–§ –´ –í –ê –ü –† –û –õ –î –ñ –≠',
                '–Ø –ß –° –ú –ò –¢ –¨ –ë –Æ'
            ];
            keyboardElement.innerHTML = '';
            
            layout.forEach(rowString => {
                const row = document.createElement('div');
                row.className = 'keyboard-row';
                
                // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–Ω–æ–ø–æ–∫ ENTER –∏ DELETE
                if (rowString.startsWith('–Ø')) {
                    const enter = document.createElement('button');
                    enter.textContent = '–í–≤–æ–¥';
                    enter.className = 'key big';
                    enter.onclick = () => handleInput('Enter');
                    row.appendChild(enter);
                }
                
                rowString.split(' ').forEach(letter => {
                    const key = document.createElement('button');
                    key.textContent = letter;
                    key.className = 'key';
                    key.onclick = () => handleInput(letter);
                    
                    const keyState = localStorage.getItem(`key_${letter}`);
                    if (keyState) {
                        key.classList.add(keyState);
                    }

                    row.appendChild(key);
                });
                
                if (rowString.startsWith('–Ø')) {
                    const del = document.createElement('button');
                    del.textContent = '‚å´';
                    del.className = 'key big';
                    del.onclick = () => handleInput('Backspace');
                    row.appendChild(del);
                }

                keyboardElement.appendChild(row);
            });
        }
        
        // --- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ü–≤–µ—Ç–∞ –∫–ª–∞–≤–∏—à–∏ ---
        function updateKeyColor(letter, status) {
            const key = Array.from(keyboardElement.querySelectorAll('.key')).find(k => k.textContent === letter);
            if (!key) return;

            const currentStatus = key.className.split(' ').find(cls => ['correct', 'present', 'absent'].includes(cls));

            if (status === 'correct') {
                key.classList.remove(currentStatus);
                key.classList.add('correct');
                localStorage.setItem(`key_${letter}`, 'correct');
            } else if (status === 'present' && currentStatus !== 'correct') {
                key.classList.remove(currentStatus);
                key.classList.add('present');
                localStorage.setItem(`key_${letter}`, 'present');
            } else if (status === 'absent' && !currentStatus) {
                key.classList.add('absent');
                localStorage.setItem(`key_${letter}`, 'absent');
            }
        }


        // --- –õ–æ–≥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–ª–æ–≤–∞ ---
        function checkGuess() {
            const guess = state.currentGuess;
            const target = state.targetWord;
            const targetMap = {};
            for (const char of target) {
                targetMap[char] = (targetMap[char] || 0) + 1;
            }

            const status = Array(WORD_LENGTH).fill('absent');
            let correctCount = 0;

            // –®–∞–≥ 1: –ù–∞—Ö–æ–¥–∏–º "correct" (–∑–µ–ª–µ–Ω—ã–µ)
            for (let i = 0; i < WORD_LENGTH; i++) {
                if (guess[i] === target[i]) {
                    status[i] = 'correct';
                    targetMap[guess[i]]--;
                    correctCount++;
                }
            }

            // –®–∞–≥ 2: –ù–∞—Ö–æ–¥–∏–º "present" (–∂–µ–ª—Ç—ã–µ) –∏ "absent" (—Å–µ—Ä—ã–µ)
            for (let i = 0; i < WORD_LENGTH; i++) {
                if (status[i] !== 'correct') {
                    if (targetMap[guess[i]] > 0) {
                        status[i] = 'present';
                        targetMap[guess[i]]--;
                    }
                }
                updateKeyColor(guess[i], status[i]);
            }
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ–ø—ã—Ç–∫—É
            state.attempts.push({ word: guess, status: status });
            state.currentGuess = '';
            state.attemptsCount++;
            
            
            // --- –õ–û–ì–ò–ö–ê –ü–û–ë–ï–î–´ ---
            if (correctCount === WORD_LENGTH) {
                state.gameStatus = 'won';
                state.lossCount = 0; 
                saveGameState();
                showMessage(`–£—Ä–∞! –¢—ã —É–≥–∞–¥–∞–ª —Å–ª–æ–≤–æ "${target}"! üéâ`);
                return;
            }

            // --- –õ–û–ì–ò–ö–ê –ü–†–û–ò–ì–†–´–®–ê –ò –ë–õ–û–ö–ò–†–û–í–ö–ò ---
            if (state.attemptsCount >= MAX_ATTEMPTS) {
                state.gameStatus = 'lost';
                
                state.lossCount++; 
                
                if (state.lossCount >= 2) {
                    state.lastFailedTime = Date.now();
                    state.isLocked = true;
                    showMessage(`–°–ª–æ–≤–æ –±—ã–ª–æ "${target}". üíî –î–≤–µ –Ω–µ—É–¥–∞—á–∏ –ø–æ–¥—Ä—è–¥ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–ª–∏ —Ç–∞–π–º–µ—Ä.`, true);
                    checkCooldown(); 
                } else {
                    showMessage(`–¢—ã –Ω–µ —É–≥–∞–¥–∞–ª. –°–ª–æ–≤–æ –±—ã–ª–æ "${target}". üòï`);
                }

                saveGameState();
            } else {
                saveGameState();
            }
        }
        
        // --- –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–≤–æ–¥–∞ (–∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –∏–ª–∏ –º—ã—à—å) ---
        function handleInput(key) {
            if (state.gameStatus !== 'playing') {
                return;
            }

            const letter = key.toUpperCase();

            if (letter === 'ENTER') {
                if (state.currentGuess.length === WORD_LENGTH) {
                    checkGuess();
                } else {
                    showMessage(`–°–ª–æ–≤–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∏–∑ ${WORD_LENGTH} –±—É–∫–≤!`, true);
                }
            } else if (letter === 'BACKSPACE' || letter === 'DELETE') {
                state.currentGuess = state.currentGuess.slice(0, -1);
            } else if (letter.length === 1 && '–ê–ë–í–ì–î–ï–Å–ñ–ó–ò–ô–ö–õ–ú–ù–û–ü–†–°–¢–£–§–•–¶–ß–®–©–™–´–¨–≠–Æ–Ø'.includes(letter)) {
                if (state.currentGuess.length < WORD_LENGTH) {
                    state.currentGuess += letter;
                }
            }
            drawBoard(); 
        }

        // --- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã ---
        function init() {
            loadGameState();
            drawBoard();
            drawKeyboard();
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Å–ª—É—à–∞—Ç–µ–ª—å –¥–ª—è —Ñ–∏–∑–∏—á–µ—Å–∫–æ–π –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
            document.addEventListener('keyup', (e) => {
                if (state.gameStatus === 'playing') {
                    if (e.key === 'Enter') {
                        handleInput('Enter');
                    } else if (e.key === 'Backspace') {
                        handleInput('Backspace');
                    } else if (e.key.length === 1) { 
                        handleInput(e.key);
                    }
                }
            });
        }

        // –ó–∞–ø—É—Å–∫!
        init();

    </script>
</body>
</html>